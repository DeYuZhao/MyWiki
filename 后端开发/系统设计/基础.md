# 系统设计基础
### 性能
* 性能指标
    * 响应时间
        ```
        请求从发出到接收所消耗的时间
        测试响应时间，一般采用重复请求，计算平均时间
        ```
    * 吞吐量
        ```
        单位时间内处理的请求数量，通常使用每秒的请求数来衡量
        ```
    * 并发用户数
        ```
        系统能同时处理的并发用户请求数量;
        在没有并发的场景中，请求是顺序执行，（响应时间 * 吞吐量 = 1秒内的请求数）;
        目前的大型系统都支持多线程来处理并发请求(多CPU，有效利用IO等待时间)，多线程能够提高吞吐量，缩短响应时间;
        使用IO多路复用等方式，在等待IO的过程中CPU可以处理其他任务，提高CPU利用率;
        并发数不是越多越好，如果并发数过高，CPU无法及时处理，会导致过多的任务等待，响应时间反而会增长
        ```
* [性能优化](性能优化.md)
    * [集群](集群.md)
        ```
        将多台服务器组成集群，使用负载均衡将请求转发到集群中，避免单一服务器的负载压力过大导致性能降低。
        ```
    * 缓存
        ```
        缓存对于提高系统性能有极大的帮助：
        1、缓存通常在内存等介质中，读写速度快
        2、缓存数据可以位于靠近用户的地理位置上
        3、缓存结果，避免重复运算
        缓存技术：
        1、CDN:内容分发网络，将请求转发到离用户最近的网络服务商，例如视频直播等
        2、反向代理：部署在前端，访问静态资源时，最先访问反向代理服务器
        3、本地缓存
        4、分布式缓存:将数据专门存储在分布式缓存集群中
        使用缓存的场景：
        1、数据访问热点不均衡，某些数据会被更频繁地访问
        2、数据在某个时间段出现，短时间内不会过期，否则失效之后会产生脏读
        ```
    * 异步
        ```
        某些流程可以将操作转换为消息，将消息发送到消息队列之后立即返回，之后这个操作会被异步处理。
        ```
    * 具体优化方式
        ```
        浏览器端：
        1、浏览器缓存
        2、页面压缩
        3、合理布局页面
        4、减少Cookie传输
        5、使用CDN（将网站静态内容分发至离用户最近的网络服务商机房，使用户通过最短路径访问。同时在机房部署反向代理服务器，缓存热点文件，加快请求响应速度，减轻应用服务器压力）
        应用服务器端：
        1、使用服务器本地缓存和分布式缓存，通过在内存中的热点数据处理用户请求，减轻数据库负载压力
        2、通过异步操作将用户请求发送至消息队列等待后续任务处理，而当前请求直接返回响应给用户
        3、将多台服务器组成集群
        代码层面：
        1、使用多线程
        2、改善内存管理
        数据库服务器端：
        1、索引、缓存、SQL、优化
        2、使用NoSQL数据库
        ```
### 伸缩性
指不断向集群中添加服务器来缓解不断上升的用户并发访问压力和不断增长的数据存储需求。
* 伸缩性与性能
    ```
    如果系统存在性能问题，那么单个用户的请求总是很慢的;
    如果系统存在伸缩性问题，那么单个用户的请求可能会很快，但是在并发数很高的情况下系统会很慢
    ```
* 伸缩性与性能
    ```
    应用服务器只要不具有状态，那么就可以很容易地通过负载均衡器向集群中添加新的服务器;
    关系型数据库的伸缩性通过 Sharding 来实现，将数据按一定的规则分布到不同的节点上，从而解决单台存储服务器的存储空间限制;
    对于非关系型数据库，它们天生就是为海量数据而诞生，对伸缩性的支持特别好
    ```
### 扩展性
指的是添加新功能时对现有系统的其它应用无影响，这就要求不同应用具备低耦合的特点。

实现可扩展主要有两种方式：

* 使用消息队列进行解耦，应用之间通过消息传递进行通信
* 使用分布式服务将业务和可复用的服务分离开来，业务使用分布式服务框架调用可复用的服务。新增的产品可以通过调用可复用的服务来实现业务逻辑，对其它产品没有影响。
### 可用性
* 冗余
    ```
    保证高可用的主要手段是使用冗余，当某个服务器故障时就请求其它服务器;
    应用服务器的冗余比较容易实现，只要保证应用服务器不具有状态，那么某个应用服务器故障时，负载均衡器将该应用服务器原先的用户请求转发到另一个应用服务器上，不会对用户有任何影响;
    存储服务器的冗余需要使用主从复制来实现，当主服务器故障时，需要提升从服务器为主服务器，这个过程称为切换。
    ```
* 监控
    ```
    对 CPU、内存、磁盘、网络等系统负载信息进行监控，当某个数据达到一定阈值时通知运维人员，从而在系统发生故障之前及时发现问题。
    ```
* 服务降级
    ```
    服务降级是系统为了应对大量的请求，主动关闭部分功能，从而保证核心功能可用。
    ```
### 安全性
要求系统在应对各种攻击手段时能够有可靠的应对措施。

### 参考
* [博客地址](https://blog.csdn.net/umbrellasoft/article/details/83044638)
* 《大型网站技术架构：核心原理与案例分析》